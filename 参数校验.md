# 参数校验

## @Validated 与 @Valid

@Validated与@Valid的作用都是指明被注解的内容是需要进行参数校验的，仅仅是指出来，具体的参数校验规则由字段上的详细注解决定。

- @Validated
  - 提供了一个分组功能，可以在入参验证时，根据不同的分组采用不同的验证机制
  - 可以用在类型、方法和方法参数上。但是不能用在成员属性（字段）上
- Valid
  - 没有分组的功能
  - 可以用在方法、构造函数、方法参数和成员属性（字段）上。（**嵌套参数校验的时候用**）

## 常用参数校验注解

![img](https://img-blog.csdnimg.cn/20200913110853722.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzMyMzUyNzc3,size_16,color_FFFFFF,t_70)

## 基础参数校验

1. 实体类中添加上图中对应注解
2. 需要用到实体类的地方，添加@Valid或@Validated注解，否则校验不生效

## 嵌套参数校验

```
    @NotNull(message = "用户不能为空！")
    // 这里就是嵌套参数校验，也就是指明UserDto也需要进行参数校验
    @Valid
    private List<UserDto> userList;
```

## 分组参数校验

1. 定义一个校验组类，声明多个接口对应不同场景校验

   ```
   public class ValidationGroups {
       public interface Update {}
       public interface Insert {}
       public interface Detail {}
       public interface Delete{}
   }
   ```

2. 在实体类具体属性添加校验规则及校验分组

   ```
   // 符合此分组的才会进行参数校验
   @NotBlank(message = "父渠道id 不能为空",groups ={ValidationGroups.Insert.class,ValidationGroups.Update.class})
   private String superRegion;
   ```

3. 在控制层@Validated注解中添加具体校验的分组名

   ```
       @PostMapping("/add")
       public void add(@RequestBody @Validated(ValidationGroups.Insert.class) RegionRequest regionRequest) {}
   ```


# 应用经验

```java
@NotEmpty(message = "请选择至少一个帖子")
private List<String> postIds;
```

```java
@NotNull(message = "请选择要分类的收藏夹")
@Min(value = 0, message = "收藏夹不存在")
private Long foldId;
```