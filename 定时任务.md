## 方案一：定时器扫描

XXL-JOB、QUAZRT等

有两种实现方式。

1.根据定时器设置的执行时机，执行sql对数据表中某时间字段与当前时间的值进行比较，获取到过期或到期的所有记录，对记录进行批量操作。

2.在新增记录时，设置一个与记录关联的redis过期key，根据定时器设置的执行时机，获取过期的key，进而获取到过期或到期的所有记录，对记录进行批量操作。

优点：实现逻辑简单，后期业务调整方便

缺点：

1.设定执行间隔长：定时器设定的执行间隔过长，会导致执行业务的时机有较大的偏差，如果业务的数据量大时，间隔时间过大会导致任务量堆叠，每次执行都会占用较大的系统资源。

2.设定执行间隔短：占用系统的时机更频繁了，也会占用系统的资源。

### xxl-job

https://juejin.cn/post/6999234357818834974

![image-20220419134150413](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c919e1840bf84670bd511e94fd34ed52~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp)



1. 调度中心获取分布式锁
2. 每一分钟扫描一次，从xxl_job_info表中找出当前时间 + 5s的所有任务，然后根据其调度时间判断是立即调度还是加入到时间戳中
3. 对加入到时间轮中的数据进行遍历调用

## 方案二：Redis过期Key回调

在新增记录时，设置一个与记录关联的redis过期key，redis在key过期时回调应用，应用中设置的监听器能收到回调消息，对该过期记录进行操作。

## 方案三：RabbitMQ 死信队列

https://juejin.cn/post/7038892531706232845

优点：

- 时效性强，rabbitmq的时效性为us级。

- 可用性强，基于主从结构的rabbitmq可以有多个节点顶替坏节点

- 吞吐量大（相对于定时任务）：单机吞吐量为万级

缺点：

- 依赖网络带宽性能，网络带宽的性能影响消息的传输时效性，所以建议mq服务器和应用服务器部署在同一内网，在内网进行数据交互。

## 参考

https://www.jianshu.com/p/f7baf43bf46f

https://www.jianshu.com/p/af174aadc278
